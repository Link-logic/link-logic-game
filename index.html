<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Link Logic - A Multiplayer Word Connection Game</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: Arial, sans-serif;
      background: #000;
      color: #fff;
      -webkit-font-smoothing: antialiased;
      overflow-x: hidden;
    }
    
    /* Screen Frame - UPDATED: Thinner border, minimal curve */
    .screen-frame {
      background: #000;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .screen-container {
      background: #000;
      border: 4px solid #7B2CBF;  /* Changed from 8px to 4px, using exact color */
      border-radius: 20px;  /* Changed from 40px to 20px for minimal curve */
      width: 100%;
      max-width: 480px;
      min-height: 85vh;
      padding: 30px 20px;
      position: relative;
    }

    .screen-container.scrollable {
      max-height: 95vh;
      overflow-y: auto;
    }

    /* Logo Styles */
    .logo-small {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 70px;
      height: auto;
      border-radius: 8px;
    }

    /* UPDATED: Logo frame fills interior with minimal gap */
    .logo-frame {
      background: #000;
      border: 4px solid #7B2CBF;  /* Thinner border */
      border-radius: 12px;  /* Minimal curve */
      padding: 10px;  /* Reduced padding */
      margin: 0 auto 30px;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      max-width: 100%;
    }

    .logo-frame img {
      width: 100%;
      max-width: 100%;
      height: auto;
      display: block;
    }

    /* Page Titles */
    .page-title {
      color: #fff;
      font-size: 42px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 30px;
    }

    .page-title-small {
      color: #fff;
      font-size: 36px;
      font-weight: bold;
      text-align: center;
      margin: 0 0 25px 0;
    }

    /* Top Bar */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .top-bar .page-title {
      flex: 1;
      margin: 0;
      font-size: 32px;
    }

    /* Timer Box */
    .timer-box {
      background: linear-gradient(135deg, #F31418 0%, #C41014 100%);
      border: 3px solid #fff;
      border-radius: 10px;
      padding: 8px 12px;
      color: #fff;
      font-size: 24px;
      font-weight: bold;
      text-align: center;
      line-height: 1.2;
      min-width: 80px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .timer-label {
      font-size: 10px;
      color: #fff;
      font-weight: normal;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* Content Box - Purple Background Container */
    .content-box {
      background: #7B2CBF;  /* Using exact purple */
      border-radius: 20px;
      padding: 25px 20px;
      margin-top: 10px;
    }

    /* Section Titles */
    .section-title {
      color: #F88E00;
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 15px;
    }

    .section-title-white {
      color: #fff;
      font-size: 22px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 20px;
    }

    .mode-header {
      color: #F31418;
      font-size: 24px;  /* Increased */
      font-weight: bold;
      text-align: center;
      margin-bottom: 20px;
    }

    .round-title {
      color: #F88E00;
      font-size: 28px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 20px;
    }

    .round-complete {
      color: #F88E00;
      font-size: 24px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 25px;
    }

    .winner-title {
      color: #F88E00;
      font-size: 56px;
      font-weight: bold;
      margin-bottom: 30px;
      text-align: center;
    }

    /* Form Elements */
    .label-orange {
      color: #F88E00;
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 8px;
      display: block;
    }

    .label-cyan {
      color: #00B0F0;  /* Using exact cyan */
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 8px;
      display: block;
    }

    .input-field {
      width: 100%;
      padding: 12px 15px;
      border-radius: 8px;
      border: none;
      background: #ECECEC;  /* Using exact gray */
      color: #000;
      font-size: 16px;
      margin-bottom: 15px;
      -webkit-user-select: text;
      user-select: text;
      -webkit-appearance: none;
      appearance: none;
      pointer-events: auto;
      touch-action: manipulation;
    }

    .input-field:focus {
      outline: 2px solid #00B0F0;
      background: #fff;
    }

    .input-field:active {
      outline: 2px solid #00B0F0;
      background: #fff;
    }

    .input-field::placeholder {
      color: #C0C0C0;  /* Using exact gray */
    }

    .input-field:read-only {
      background: #F5F5F5;
      color: #666;
    }

    .input-gradient {
      border: 3px solid #F88E00;
      border-radius: 8px;
      background: linear-gradient(90deg, 
        rgba(255,152,0,0.1),
        rgba(255,87,34,0.1),
        rgba(233,30,99,0.1),
        rgba(123,44,191,0.1));
    }

    .required-text {
      color: #F88E00;
      font-size: 14px;
      margin: 5px 0 15px 0;
    }

    .heading-cyan {
      color: #00B0F0;
      font-size: 22px;
      font-weight: bold;
      margin: 25px 0 15px 0;
      text-align: center;
    }

    /* Input Rows */
    .input-row {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }

    .input-group {
      flex: 1;
    }

    .input-label {
      color: #fff;
      font-size: 14px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 8px;
    }

    .input-box {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: none;
      background: #fff;
      text-align: center;
      color: #666;
      font-size: 14px;
    }

    /* Buttons - UPDATED: Enter button centered and deeper purple */
    .btn-enter {
      background: #7B2CBF;  /* Deeper purple */
      color: #fff;
      border: none;
      border-radius: 30px;
      padding: 18px 80px;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.2s;
      margin: 30px auto 0;  /* Centered */
      display: block;
    }

    .btn-enter:hover {
      transform: scale(1.05);
    }

    .btn-enter:active {
      transform: scale(0.98);
    }

    .btn {
      padding: 15px 30px;
      border-radius: 12px;
      border: none;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.1s;
    }

    .btn:active {
      transform: scale(0.98);
    }

    .btn-action {
      width: 100%;
      padding: 18px;
      border-radius: 12px;
      border: none;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 8px;  /* Reduced from 12px */
      transition: transform 0.1s;
      color: #fff;
    }

    .btn-red { background: #F31418; }  /* Using exact red */
    .btn-orange { background: #F88E00; }  /* Using exact orange */
    .btn-cyan { background: #00B0F0; }  /* Using exact cyan */
    .btn-purple { background: #7B2CBF; }  /* Using exact purple */

    .btn-small {
      width: auto;
      padding: 12px 40px;
      font-size: 16px;
      background: #F88E00;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin: 20px auto 0;
      display: block;
      font-weight: bold;
    }

    .btn-gray {
      background: #C0C0C0;
      color: #666;
      width: 100%;
      margin-bottom: 15px;
    }

    .btn-large {
      width: 100%;
      padding: 15px;
      border-radius: 12px;
      background: transparent;
      border: 3px solid #fff;
      color: #fff;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.1s;
    }

    .btn-large:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .btn-submit {
      width: 100%;
      padding: 18px;
      border-radius: 12px;
      background: #F88E00;
      border: none;
      color: #fff;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 15px;
      transition: transform 0.1s;
    }

    .btn-host {
      width: 100%;
      padding: 18px;
      border-radius: 12px;
      background: #F31418;
      border: none;
      color: #fff;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 20px;  /* Reduced from 25px */
      transition: transform 0.1s;
    }

    .btn-next-round {
      width: 100%;
      padding: 18px;
      border-radius: 12px;
      background: #F88E00;
      border: none;
      color: #fff;
      font-size: 22px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 20px;
      transition: transform 0.1s;
    }

    /* Button Rows */
    .button-row {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-top: 15px;
    }

    .button-row .btn {
      flex: 1;
    }

    .button-row-presets {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 20px;
    }

    .btn-preset-control {
      flex: 1;
      padding: 10px;  /* Reduced from 12px */
      border-radius: 10px;
      border: none;
      font-size: 15px;  /* Reduced from 16px */
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.1s;
    }

    .btn-game {
      padding: 15px 35px;
      border-radius: 10px;
      border: none;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.1s;
    }

    /* Next Step Text - UPDATED: Align left */
    .next-step {
      color: #fff;
      font-size: 14px;
      text-align: left;  /* Changed from center */
      margin-bottom: 15px;  /* Reduced from 20px */
      padding-left: 5px;
    }

    /* UPDATED: Larger font for subtitle */
    .subtitle {
      color: #fff;
      font-size: 22px;  /* Increased from 20px */
      text-align: center;
      margin-bottom: 15px;
      line-height: 1.4;
    }

    /* Word Grid */
    .word-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      background: #fff;
      border: 3px solid #7B2CBF;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .word-box {
      background: #00B0F0;  /* Using exact cyan */
      padding: 15px 10px;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
      color: #000;
      font-size: 13px;
      cursor: pointer;
      transition: transform 0.1s;
      user-select: none;
    }

    .word-box.bonus {
      background: #F88E00;  /* Using exact orange */
    }

    .word-box.selected {
      background: #7B2CBF;
      color: #fff;
      transform: scale(1.05);
    }

    .word-box:active {
      transform: scale(0.95);
    }

    /* Preset Grid - UPDATED with exact colors */
    .preset-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 25px;
    }

    .preset-btn {
      padding: 18px 10px;  /* Reduced from 20px */
      border-radius: 12px;
      border: none;
      font-size: 16px;
      font-weight: bold;
      color: #fff;
      cursor: pointer;
      transition: transform 0.1s;
      text-align: center;
    }

    .preset-btn:active {
      transform: scale(0.95);
    }

    .preset-btn.selected {
      box-shadow: 0 0 0 4px #fff;
    }

    /* Exact preset colors from palette */
    .preset-1 { background: #00CCFF; }
    .preset-2 { background: #0099FF; }
    .preset-3 { background: #0066FF; }
    .preset-4 { background: #FFCC00; color: #000; }
    .preset-5 { background: #FF9933; }
    .preset-6 { background: #FF6600; }
    .preset-7 { background: #FF7F7F; }
    .preset-8 { background: #FF3737; }
    .preset-9 { background: #F31418; }

    /* Preset Info Box - UPDATED heading */
    .preset-info-box {
      background: #fff;
      border: 3px solid #000;
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      color: #000;
    }

    .preset-info-box h3 {
      font-size: 18px;
      margin-bottom: 5px;
      text-align: center;
    }

    .preset-info-box .subtitle {
      font-size: 14px;
      margin-bottom: 15px;
      text-align: center;
      color: #666;
    }

    .preset-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      font-size: 15px;
    }

    .preset-details div {
      text-align: left;
    }

    /* Room Number */
    .room-number-row {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 25px;
    }

    .room-label {
      background: #00B0F0;
      color: #fff;
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: bold;
      white-space: nowrap;
    }

    .room-display {
      background: #fff;
      padding: 10px 15px;
      border-radius: 8px;
      flex: 1;
      text-align: center;
      color: #666;
      font-size: 16px;
      font-weight: bold;
    }

    /* Invitation Box - UPDATED: Copy button to the right */
    .invite-section {
      margin-bottom: 15px;
    }

    .invite-container {
      display: flex;
      gap: 10px;
      align-items: stretch;
      margin-bottom: 15px;
    }

    .invite-box {
      background: #fff;
      border-radius: 12px;
      padding: 15px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .invite-box label {
      color: #666;
      font-size: 14px;
      display: block;
      margin-bottom: 8px;
    }

    .invite-box textarea {
      width: 100%;
      min-height: 80px;
      border: none;
      background: transparent;
      resize: vertical;
      font-family: inherit;
      font-size: 14px;
      color: #000;
      flex: 1;
    }

    .invite-text {
      color: #000;
      font-size: 14px;
      line-height: 1.6;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #ddd;
    }

    .auto-text {
      color: #00B0F0;
      font-weight: bold;
    }

    /* Copy Button - Now vertical next to textarea */
    .copy-btn-vertical {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 5px;
      min-width: 80px;
    }

    .copy-icon {
      background: #00B0F0;
      color: #fff;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .copy-label {
      color: #fff;
      font-size: 12px;
      font-weight: bold;
      text-align: center;
      line-height: 1.2;
    }

    /* Traffic Lights / Countdown - UPDATED: Red, Yellow, Green */
    .traffic-lights {
      display: flex;
      justify-content: space-around;
      margin: 20px 0;
    }

    .traffic-light {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: #ECECEC;
      border: 4px solid #7B2CBF;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: bold;
      color: #666;
    }

    .traffic-light.active-red {
      background: #F31418;
      color: #fff;
      animation: pulse 0.5s;
    }

    .traffic-light.active-yellow {
      background: #FFCC00;
      color: #000;
      animation: pulse 0.5s;
    }

    .traffic-light.active-green {
      background: #4CAF50;
      color: #fff;
      animation: pulse 0.5s;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    /* Players Ready */
    .players-ready-box {
      background: #fff;
      border: 3px solid #000;
      border-radius: 15px;
      padding: 15px;
    }

    .players-ready-title {
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 15px;
      color: #000;
    }

    .player-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .player-box {
      background: #fff;
      border: 3px solid #7B2CBF;
      border-radius: 10px;
      padding: 12px;
      text-align: center;
      color: #666;
      font-size: 14px;
    }

    /* Game Preview */
    .game-preview {
      background: #7B2CBF;
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 15px;
    }

    .game-preview .word-grid {
      gap: 8px;
      padding: 12px;
      margin-bottom: 15px;
    }

    .game-preview .word-box {
      padding: 10px;
      font-size: 12px;
    }

    .game-preview .input-box {
      padding: 8px;
    }

    .game-preview .input-label {
      font-size: 12px;
      margin-bottom: 5px;
    }

    /* Controls Box */
    .controls-box {
      background: #7B2CBF;
      border-radius: 20px;
      padding: 20px;
    }

    .button-row-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .btn-host-small {
      background: #F88E00;
      color: #fff;
      padding: 10px 20px;
      border-radius: 10px;
      border: none;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
    }

    .btn-tap {
      background: #00B0F0;
      color: #fff;
      padding: 10px 30px;
      border-radius: 10px;
      border: none;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      flex: 1;
    }

    .btn-waiting {
      background: #00B0F0;
      color: #fff;
      padding: 12px;
      border-radius: 10px;
      border: none;
      font-size: 18px;
      font-weight: bold;
      width: 100%;
      margin-bottom: 20px;
    }

    /* Keyboard */
    .keyboard {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 8px;
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 4px;
    }

    .key {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 10px 4px;
      text-align: center;
      font-size: 12px;
      color: #000;
      cursor: pointer;
      user-select: none;
      font-weight: 500;
    }

    .key:active {
      background: #ddd;
    }

    .key-wide {
      grid-column: span 2;
    }

    .key-space {
      grid-column: span 5;
    }

    /* Scoring Tables - UPDATED: Player names smaller and left-aligned */
    .player-table {
      margin-bottom: 15px;  /* Reduced from 20px */
    }

    .player-name-header {
      background: #fff;
      border: 3px solid #F88E00;
      border-radius: 8px;
      padding: 8px 12px;  /* Reduced padding */
      margin-bottom: 10px;
      font-weight: bold;
      color: #000;
      text-align: left;  /* Changed from center */
      font-size: 16px;  /* Reduced from default */
    }

    .table-content {
      background: #fff;
      border-radius: 8px;
      padding: 10px;
    }

    .table-header {
      display: grid;
      grid-template-columns: 30px 2fr 1fr 60px 60px;
      padding: 8px 5px;
      font-weight: bold;
      font-size: 12px;
      color: #000;
      border-bottom: 2px solid #eee;
      gap: 5px;
      align-items: center;
    }

    .table-row {
      display: grid;
      grid-template-columns: 30px 2fr 1fr 60px 60px;
      padding: 10px 5px;
      align-items: center;
      border-bottom: 1px solid #eee;
      font-size: 12px;
      color: #000;
      gap: 5px;
    }

    .table-row:last-child {
      border-bottom: none;
    }

    .link-word {
      color: #00B0F0;
      font-weight: bold;
    }

    /* UPDATED: Thumbs up icon */
    .icon-btn {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      border: none;
      background: #00B0F0;
      color: #fff;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      margin: 0 auto;
    }

    .icon-btn.like {
      background: #F88E00;
    }

    .points {
      color: #4CAF50;
      font-weight: bold;
    }

    /* Winner Screen */
    .trophy {
      font-size: 100px;
      margin: 20px 0 30px;
      text-align: center;
    }

    .trophy img {
      width: 120px;
      height: auto;
    }

    .winner-name-box {
      background: #fff;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 30px;
      color: #666;
      font-size: 18px;
      text-align: center;
    }

    .standings-table {
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 30px;
    }

    /* UPDATED: Final Standings centered */
    .table-header-section {
      background: #ECECEC;
      padding: 12px;
      font-weight: bold;
      font-size: 18px;
      color: #000;
      border-bottom: 2px solid #7B2CBF;
      text-align: center;  /* Centered */
    }

    .table-header-row {
      display: grid;
      grid-template-columns: 1.5fr 1fr 1fr;
      padding: 10px;
      background: #F5F5F5;
      font-weight: bold;
      font-size: 14px;
      color: #000;
      border-bottom: 2px solid #ddd;
    }

    .table-row-standings {
      display: grid;
      grid-template-columns: 1.5fr 1fr 1fr;
      padding: 10px;
      color: #666;
      font-size: 14px;
      border-bottom: 1px solid #eee;
    }

    .table-row-standings:last-child {
      border-bottom: none;
    }

    /* Instructions */
    .section-header {
      color: #F88E00;
      font-size: 18px;
      font-weight: bold;
      margin: 20px 0 10px 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-header:first-child {
      margin-top: 0;
    }

    .checkbox-icon {
      color: #F88E00;
      font-size: 20px;
    }

    .content-box p {
      margin-bottom: 10px;
      color: #fff;
    }

    .content-box ol {
      margin-left: 20px;
      margin-bottom: 15px;
      color: #fff;
    }

    .content-box ol li {
      margin-bottom: 8px;
    }

    .content-box ul {
      margin-left: 20px;
      margin-bottom: 10px;
      color: #fff;
    }

    .content-box ul li {
      margin-bottom: 5px;
    }

    .example-box {
      background: rgba(255, 255, 255, 0.15);
      padding: 12px;
      border-radius: 8px;
      margin: 10px 0;
    }

    /* Coming Soon - Simplified */
    .coming-soon-title {
      color: #fff;
      font-size: 18px;
      text-align: center;
      margin: 20px 0 10px;
    }

    .coming-soon-subtitle {
      color: #fff;
      font-size: 14px;
      text-align: center;
      margin-bottom: 10px;
    }

    .coming-soon-placeholder {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      color: #fff;
      font-size: 14px;
    }

    .placeholder-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      padding: 8px;
      background: #00B0F0;
      color: #fff;
      border-radius: 5px;
      font-size: 12px;
      font-weight: bold;
      text-align: center;
    }

    /* Responsive */
    @media (max-width: 480px) {
      .screen-container {
        padding: 20px 15px;
        min-height: 95vh;
      }

      .page-title {
        font-size: 36px;
      }

      .page-title-small {
        font-size: 30px;
      }

      .logo-frame {
        padding: 8px;
      }

      .word-grid {
        gap: 8px;
        padding: 10px;
      }

      .word-box {
        padding: 12px 8px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyA26M1QoRi-9iM78jSnn07S4d_8jSy3KIA",
      authDomain: "link-logic-b7aad.firebaseapp.com",
      projectId: "link-logic-b7aad",
      databaseURL: "https://link-logic-b7aad-default-rtdb.firebaseio.com",
      storageBucket: "link-logic-b7aad.firebasestorage.app",
      messagingSenderId: "411607668860",
      appId: "1:411607668860:web:d875c4e4400dbaacda51f9"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Word banks
    const WORD_BANKS = {
      training: ['CAT', 'DOG', 'SUN', 'MOON', 'CAR', 'BUS', 'RED', 'BLUE', 'HOT', 'COLD', 
                 'BIG', 'SMALL', 'UP', 'DOWN', 'YES', 'NO', 'DAY', 'NIGHT', 'HAPPY', 'SAD'],
      children: ['HARD', 'ANIMAL', 'SWING', 'FIRE', 'WARM', 'STONE', 'GREEN', 'BOOK', 'COLD', 'SOFT', 'PAPER', 'HOUSE',
                 'APPLE', 'TREE', 'HOUSE', 'WATER', 'FIRE', 'PAPER', 'BOOK', 'GREEN'],
      beginners: ['ABSTRACT', 'CONCEPT', 'THEORY', 'LOGIC', 'REASON', 'EMOTION', 'THOUGHT', 'MEMORY', 'DREAM', 'REALITY',
                  'TRADITION', 'CULTURE', 'SOCIETY', 'COMMUNITY', 'INDIVIDUAL', 'FREEDOM', 'JUSTICE', 'EQUALITY'],
      adults: ['PHILOSOPHY', 'ETHICS', 'MORALITY', 'VIRTUE', 'INTEGRITY', 'HONESTY', 'TRUST', 'LOYALTY', 'RESPECT', 'DIGNITY',
               'CONFLICT', 'RESOLUTION', 'COMPROMISE', 'NEGOTIATION', 'AGREEMENT', 'COOPERATION']
    };

    // Preset configurations - FROM EXCEL FILE
    const PRESETS = {
      1: { name: 'Preset 1', level: 'Easy', words: 22, timer: 120, rounds: 5, bonusWords: 5, difficulty: 'training' },
      2: { name: 'Preset 2', level: 'Easy', words: 20, timer: 110, rounds: 5, bonusWords: 4, difficulty: 'children' },
      3: { name: 'Preset 3', level: 'Easy', words: 18, timer: 100, rounds: 5, bonusWords: 3, difficulty: 'children' },
      4: { name: 'Preset 4', level: 'Medium', words: 20, timer: 110, rounds: 5, bonusWords: 4, difficulty: 'beginners' },
      5: { name: 'Preset 5', level: 'Medium', words: 18, timer: 100, rounds: 5, bonusWords: 3, difficulty: 'beginners' },
      6: { name: 'Preset 6', level: 'Medium', words: 16, timer: 90, rounds: 5, bonusWords: 2, difficulty: 'beginners' },
      7: { name: 'Preset 7', level: 'Difficult', words: 18, timer: 100, rounds: 5, bonusWords: 3, difficulty: 'adults' },
      8: { name: 'Preset 8', level: 'Difficult', words: 16, timer: 90, rounds: 5, bonusWords: 2, difficulty: 'adults' },
      9: { name: 'Preset 9', level: 'Difficult', words: 14, timer: 80, rounds: 5, bonusWords: 1, difficulty: 'adults' }
    };

    // Utility functions
    const generateRoomCode = () => Math.random().toString(36).substring(2, 8).toUpperCase();
    
    const shuffleArray = (array) => {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    };

    const generateWords = (difficulty, numWords, bonusCount = 0) => {
      const wordBank = WORD_BANKS[difficulty] || WORD_BANKS.children;
      const shuffled = shuffleArray(wordBank);
      const selectedWords = shuffled.slice(0, Math.min(numWords, wordBank.length));
      
      const bonusIndices = [];
      if (bonusCount > 0) {
        const indices = Array.from({length: selectedWords.length}, (_, i) => i);
        const shuffledIndices = shuffleArray(indices);
        bonusIndices.push(...shuffledIndices.slice(0, Math.min(bonusCount, selectedWords.length)));
      }
      
      return selectedWords.map((word, idx) => ({
        text: word,
        isBonus: bonusIndices.includes(idx),
        id: idx
      }));
    };

    // Logo URLs
    const LOGO_FULL = "https://raw.githubusercontent.com/Link-logic/link-logic-game/main/logo-full.png";
    const LOGO_SMALL = "https://raw.githubusercontent.com/Link-logic/link-logic-game/main/logo-small.png";
    const TROPHY_IMG = "https://raw.githubusercontent.com/Link-logic/link-logic-game/main/trophy.png";

    // Main App Component
    const LinkLogicApp = () => {
      const [screen, setScreen] = useState('welcome');
      const [playerName, setPlayerName] = useState('');
      const [playerRating, setPlayerRating] = useState(500);  // Start at 500
      
      // Registration state
      const [regName, setRegName] = useState('');
      const [regCell, setRegCell] = useState('');
      const [regEmail, setRegEmail] = useState('');
      const [regPlayerName, setRegPlayerName] = useState('');
      const [playerNameAvailable, setPlayerNameAvailable] = useState(null);
      
      // Game state
      const [roomCode, setRoomCode] = useState('');
      const [selectedPreset, setSelectedPreset] = useState(3);
      const [presetConfig, setPresetConfig] = useState(PRESETS[3]);
      const [gameWords, setGameWords] = useState([]);
      const [selectedWords, setSelectedWords] = useState([]);
      const [linkWord, setLinkWord] = useState('');
      const [currentRound, setCurrentRound] = useState(1);
      const [timeLeft, setTimeLeft] = useState(20);
      const [playersReady, setPlayersReady] = useState(['Player1', 'Player2']);
      const [countdown, setCountdown] = useState(0);
      const [inviteMessage, setInviteMessage] = useState('');
      const [submissions, setSubmissions] = useState([]);
      const [returnScreen, setReturnScreen] = useState('register');  // Track where to return from instructions
      const [challengePopup, setChallengePopup] = useState(null);
      const [challengedSubmissions, setChallengedSubmissions] = useState({});
      
      // Check if player is registered
      useEffect(() => {
        const registration = localStorage.getItem('linkLogicRegistration');
        if (registration) {
          const data = JSON.parse(registration);
          setPlayerName(data.playerName);
          setPlayerRating(data.rating || 500);
        }
      }, []);

      // Timer effect
      useEffect(() => {
        if (screen === 'gameplay' && timeLeft > 0) {
          const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);
          return () => clearTimeout(timer);
        } else if (screen === 'gameplay' && timeLeft === 0) {
          setScreen('scoring');
        }
      }, [screen, timeLeft]);

      // Sound effects function
      const playSound = (type) => {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        if (type === 'like') {
          // Happy ascending tone
          oscillator.frequency.value = 523.25; // C5
          gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 0.3);
          
          // Add second tone
          setTimeout(() => {
            const osc2 = audioContext.createOscillator();
            const gain2 = audioContext.createGain();
            osc2.connect(gain2);
            gain2.connect(audioContext.destination);
            osc2.frequency.value = 659.25; // E5
            gain2.gain.setValueAtTime(0.3, audioContext.currentTime);
            gain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            osc2.start(audioContext.currentTime);
            osc2.stop(audioContext.currentTime + 0.3);
          }, 100);
        } else if (type === 'challenge') {
          // Alert tone
          oscillator.frequency.value = 440; // A4
          oscillator.type = 'square';
          gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + 0.2);
        }
      };

      // Firebase Room Management Functions
      const createRoom = async (roomCode, hostName, preset) => {
        try {
          const roomRef = database.ref(`rooms/${roomCode}`);
          const words = generateWords(preset.difficulty, preset.words, preset.bonusWords);
          
          await roomRef.set({
            host: hostName,
            preset: preset,
            players: {
              [hostName]: {
                name: hostName,
                rating: playerRating,
                isHost: true,
                ready: false,
                joinedAt: Date.now()
              }
            },
            gameState: 'waiting', // waiting, countdown, playing, scoring, finished
            currentRound: 1,
            words: words,
            submissions: {},
            createdAt: Date.now()
          });
          
          console.log(`Room ${roomCode} created by ${hostName}`);
          return true;
        } catch (error) {
          console.error('Error creating room:', error);
          return false;
        }
      };

      const joinRoom = async (roomCode, playerName) => {
        try {
          const roomRef = database.ref(`rooms/${roomCode}`);
          const snapshot = await roomRef.once('value');
          
          if (!snapshot.exists()) {
            alert('Room not found. Please check the room number.');
            return false;
          }
          
          const playersRef = roomRef.child('players').child(playerName);
          await playersRef.set({
            name: playerName,
            rating: playerRating,
            isHost: false,
            ready: true,
            joinedAt: Date.now()
          });
          
          console.log(`${playerName} joined room ${roomCode}`);
          return true;
        } catch (error) {
          console.error('Error joining room:', error);
          alert('Failed to join room. Please try again.');
          return false;
        }
      };

      const listenToRoom = (roomCode, callback) => {
        const roomRef = database.ref(`rooms/${roomCode}`);
        roomRef.on('value', (snapshot) => {
          if (snapshot.exists()) {
            callback(snapshot.val());
          }
        });
        return () => roomRef.off();
      };

      // Challenge Popup Component - REDESIGNED
      const ChallengePopup = ({ playerName, submission, submissionKey, onClose }) => {
        const defenseRef = useRef(null);

        const handleSubmitDefense = () => {
          const defense = defenseRef.current?.value || '';
          console.log(`Defense submitted for ${submissionKey}:`, defense);
          // Mark as challenged
          setChallengedSubmissions({
            ...challengedSubmissions,
            [submissionKey]: { defense, status: 'defended' }
          });
          playSound('like'); // Success sound
          onClose();
        };

        return (
          <div style={{
            position: 'fixed',
            top: 0,
            left: 0,
            right: 0,
            bottom: 0,
            background: 'rgba(0, 0, 0, 0.85)',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 1000,
            padding: '20px',
            backdropFilter: 'blur(4px)'
          }}>
            <div style={{
              background: 'linear-gradient(135deg, #7B2CBF 0%, #5A1F8F 100%)',
              borderRadius: '24px',
              padding: '0',
              maxWidth: '480px',
              width: '100%',
              border: '4px solid #F31418',
              boxShadow: '0 10px 40px rgba(0, 0, 0, 0.5)',
              overflow: 'hidden'
            }}>
              {/* Header */}
              <div style={{
                background: 'linear-gradient(90deg, #F31418 0%, #C41014 100%)',
                padding: '20px',
                borderBottom: '3px solid #fff'
              }}>
                <h2 style={{
                  color: '#fff',
                  fontSize: '28px',
                  fontWeight: 'bold',
                  textAlign: 'center',
                  margin: 0,
                  textShadow: '2px 2px 4px rgba(0,0,0,0.3)'
                }}>⚠️ Challenge Defense</h2>
              </div>

              {/* Content */}
              <div style={{padding: '25px'}}>
                {/* Player Info Box */}
                <div style={{
                  background: '#fff',
                  borderRadius: '12px',
                  padding: '18px',
                  marginBottom: '20px',
                  color: '#000',
                  boxShadow: '0 4px 12px rgba(0,0,0,0.2)'
                }}>
                  <div style={{
                    display: 'grid',
                    gridTemplateColumns: '1fr',
                    gap: '12px'
                  }}>
                    <div style={{
                      borderBottom: '2px solid #ECECEC',
                      paddingBottom: '10px'
                    }}>
                      <strong style={{color: '#7B2CBF', fontSize: '14px'}}>PLAYER:</strong>
                      <div style={{fontSize: '18px', fontWeight: 'bold', marginTop: '4px'}}>{playerName}</div>
                    </div>
                    <div style={{
                      borderBottom: '2px solid #ECECEC',
                      paddingBottom: '10px'
                    }}>
                      <strong style={{color: '#7B2CBF', fontSize: '14px'}}>WORDS:</strong>
                      <div style={{fontSize: '16px', marginTop: '4px'}}>{submission.words}</div>
                    </div>
                    <div>
                      <strong style={{color: '#7B2CBF', fontSize: '14px'}}>LINK WORD:</strong>
                      <div style={{
                        color: '#00B0F0',
                        fontWeight: 'bold',
                        fontSize: '20px',
                        marginTop: '4px',
                        textTransform: 'uppercase'
                      }}>{submission.linkWord}</div>
                    </div>
                  </div>
                </div>
                
                {/* Defense Input */}
                <div style={{marginBottom: '20px'}}>
                  <label style={{
                    color: '#F88E00',
                    fontSize: '18px',
                    fontWeight: 'bold',
                    display: 'block',
                    marginBottom: '10px',
                    textShadow: '1px 1px 2px rgba(0,0,0,0.3)'
                  }}>Your Defense:</label>
                  <textarea
                    ref={defenseRef}
                    placeholder="Explain how your link word connects the selected words..."
                    style={{
                      width: '100%',
                      minHeight: '100px',
                      padding: '14px',
                      borderRadius: '10px',
                      border: '3px solid #00B0F0',
                      fontSize: '15px',
                      fontFamily: 'Arial, sans-serif',
                      resize: 'vertical',
                      boxShadow: 'inset 0 2px 4px rgba(0,0,0,0.1)'
                    }}
                  />
                </div>
                
                {/* Buttons */}
                <div style={{display: 'flex', gap: '12px'}}>
                  <button
                    onClick={handleSubmitDefense}
                    style={{
                      flex: 1,
                      padding: '16px',
                      borderRadius: '12px',
                      background: 'linear-gradient(135deg, #00B0F0 0%, #0088CC 100%)',
                      border: 'none',
                      color: '#fff',
                      fontSize: '18px',
                      fontWeight: 'bold',
                      cursor: 'pointer',
                      boxShadow: '0 4px 12px rgba(0, 176, 240, 0.4)',
                      transition: 'transform 0.1s'
                    }}
                    onMouseDown={(e) => e.target.style.transform = 'scale(0.98)'}
                    onMouseUp={(e) => e.target.style.transform = 'scale(1)'}
                  >
                    ✓ Submit Defense
                  </button>
                  <button
                    onClick={onClose}
                    style={{
                      flex: 1,
                      padding: '16px',
                      borderRadius: '12px',
                      background: 'linear-gradient(135deg, #666 0%, #444 100%)',
                      border: 'none',
                      color: '#fff',
                      fontSize: '18px',
                      fontWeight: 'bold',
                      cursor: 'pointer',
                      boxShadow: '0 4px 12px rgba(0, 0, 0, 0.3)',
                      transition: 'transform 0.1s'
                    }}
                    onMouseDown={(e) => e.target.style.transform = 'scale(0.98)'}
                    onMouseUp={(e) => e.target.style.transform = 'scale(1)'}
                  >
                    × Cancel
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // Welcome Screen
      const WelcomeScreen = () => (
        <div className="screen-frame">
          <div className="screen-container">
            <h1 className="page-title">Welcome</h1>
            
            <div className="logo-frame">
              <img src={LOGO_FULL} alt="Link Logic" onError={(e) => {
                e.target.src = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='250'%3E%3Crect fill='%237B2CBF' width='400' height='250'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial' font-size='48' fill='white' font-weight='bold'%3ELink Logic%3C/text%3E%3C/svg%3E";
              }} />
            </div>
            
            <div className="subtitle">
              A Multiplayer<br/>Word Connection Game
            </div>
            
            <button 
              className="btn-enter" 
              onClick={() => setScreen(playerName ? 'playerModes' : 'register')}
            >
              Enter
            </button>
          </div>
        </div>
      );

      // Register Screen - Simple version that works
      const RegisterScreen = () => {
        const checkAvailability = async () => {
          if (regPlayerName.length < 3) {
            setPlayerNameAvailable(false);
            return;
          }
          const isAvailable = !['admin', 'test', 'user'].includes(regPlayerName.toLowerCase());
          setPlayerNameAvailable(isAvailable);
        };

        const handleRegister = () => {
          if (!regName || !regCell || !regPlayerName || !playerNameAvailable) {
            alert('Please fill all required fields and choose an available player name');
            return;
          }
          
          const registration = {
            name: regName,
            cell: regCell,
            email: regEmail,
            playerName: regPlayerName,
            rating: 500,
            registeredAt: new Date().toISOString()
          };
          
          localStorage.setItem('linkLogicRegistration', JSON.stringify(registration));
          setPlayerName(regPlayerName);
          setPlayerRating(500);
          setScreen('playerModes');
        };

        return (
          <div className="screen-frame">
            <div className="screen-container scrollable">
              <img src={LOGO_SMALL} alt="Link Logic" className="logo-small" onError={(e) => e.target.style.display = 'none'} />
              
              <h1 className="page-title-small">Register</h1>
              
              <div className="content-box">
                <label className="label-orange">Your Name*</label>
                <input 
                  type="text" 
                  className="input-field" 
                  placeholder="Enter your full name"
                  defaultValue={regName}
                  onInput={(e) => setRegName(e.target.value)}
                />
                
                <label className="label-orange">Your Cell*</label>
                <input 
                  type="tel" 
                  className="input-field" 
                  placeholder="Enter your phone number"
                  defaultValue={regCell}
                  onInput={(e) => setRegCell(e.target.value)}
                />
                
                <label className="label-orange">Your Email</label>
                <input 
                  type="email" 
                  className="input-field" 
                  placeholder="Enter your email"
                  defaultValue={regEmail}
                  onInput={(e) => setRegEmail(e.target.value)}
                />
                
                <div className="required-text">* Required</div>
                
                <h2 className="heading-cyan">Create your Player Profile</h2>
                
                <input 
                  type="text" 
                  className="input-field input-gradient" 
                  placeholder="Type in a Player Name"
                  defaultValue={regPlayerName}
                  onInput={(e) => setRegPlayerName(e.target.value)}
                  onBlur={checkAvailability}
                />
                
                <button className="btn btn-cyan" onClick={checkAvailability}>
                  Check for Availability
                </button>
                
                {playerNameAvailable === false && (
                  <button className="btn btn-gray">Not Available - Try Again</button>
                )}
                {playerNameAvailable === true && (
                  <button className="btn btn-cyan" style={{background: '#4CAF50'}}>Available!</button>
                )}
                
                <div className="button-row">
                  <button className="btn btn-orange" onClick={() => {
                    setReturnScreen('register');
                    setScreen('instructions');
                  }}>
                    Instructions
                  </button>
                  <button className="btn btn-orange" onClick={handleRegister}>
                    Ready to Play?
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // Instructions Screen - with Back button
      const InstructionsScreen = () => (
        <div className="screen-frame">
          <div className="screen-container scrollable">
            <img src={LOGO_SMALL} alt="Link Logic" className="logo-small" onError={(e) => e.target.style.display = 'none'} />
            
            <h1 className="page-title-small">Instructions</h1>
            
            <div className="content-box" style={{maxHeight: '70vh', overflowY: 'auto'}}>
              <div className="section-header">
                <span className="checkbox-icon">☑</span>
                <span>Objective</span>
              </div>
              <p>Find creative connections between random words using a "link" word.</p>
              
              <div className="section-header">
                <span className="checkbox-icon">☑</span>
                <span>Game Setup (Host)</span>
              </div>
              <ol>
                <li>The Host texts invitations to registered players.</li>
                <li>The Host then chooses a "Preset" to set up the game parameters (# of rounds, # of words, # of bonus Words, and the time limit for each round).</li>
                <li>The Host can play the game as formatted or can edit the Presets and save the adjustments made. Presets can always be reset to the origin settings by pushing the Reset button.</li>
                <li>Players enter the game through the texted invitation and their Room # and Players Name self-populate. They then click "Join a Game to enter the active game room.</li>
              </ol>
              
              <div className="section-header">
                <span className="checkbox-icon">☑</span>
                <span>How to Play</span>
              </div>
              <ol>
                <li>The Host then starts the game, the count down begins, and the game screen appears.</li>
                <li>Each player see's the number of preselect random words in a table at the top of the page, with random "Bonus" words highlighted.</li>
                <li>Players then select 2 or more words that they can connect with a link word.</li>
                <li>After clicking on the words in the table they type in a "link" word that connects to the same words. Once done, they then hit the "Submit" button to save their link for scoring.</li>
                <li>Players continue linking words until the timer goes off.</li>
              </ol>
              
              <div className="section-header">
                <span className="checkbox-icon">☑</span>
                <span>Example</span>
              </div>
              <div className="example-box">
                <p><strong>Words:</strong> SNOW, FIRE  <strong>Link Word:</strong> WHITE</p>
                <p><strong>Connection:</strong> Snow is white, fire can burn white-hot</p>
              </div>
              
              <div className="section-header">
                <span className="checkbox-icon">☑</span>
                <span>Scoring</span>
              </div>
              <p><strong>Standard Word Links</strong></p>
              <ul>
                <li>2 words = 2 points</li>
                <li>3 words = 4 points</li>
                <li>4 words = 8 points</li>
                <li>5+ words = 16 points</li>
              </ul>
              <p><strong>Bonus Word Links</strong></p>
              <ul>
                <li>1 additional point per linked bonus word. Bonus words are highlighted in the word table.</li>
              </ul>
              
              <div className="section-header">
                <span className="checkbox-icon">☑</span>
                <span>Challenges</span>
              </div>
              <p>If you think someone's link doesn't work, challenge it! The player who was challenged, then has the opportunity to defend the link by typing in their defense. The other players then vote to accept or reject the link.</p>
              
              <div className="section-header">
                <span className="checkbox-icon">☑</span>
                <span>Like Points</span>
              </div>
              <p>Vote for the funniest or most creative link each round! Voting is optional but in every round one link is usually unique.</p>
              
              <div className="section-header">
                <span className="checkbox-icon">☑</span>
                <span>Winner</span>
              </div>
              <p>The player with the most points after all rounds is the winner!</p>
            </div>
            
            <button className="btn-small" style={{marginTop: '15px', background: '#F88E00'}} onClick={() => setScreen(returnScreen)}>
              Back
            </button>
          </div>
        </div>
      );

      // Player Modes Screen - UPDATED with Room # input for joining + Firebase
      const PlayerModesScreen = () => {
        const [joinRoomCode, setJoinRoomCode] = useState('');

        // Check for room code in URL on mount
        useEffect(() => {
          const urlParams = new URLSearchParams(window.location.search);
          const urlRoomCode = urlParams.get('room');
          if (urlRoomCode && playerName) {
            setJoinRoomCode(urlRoomCode);
            // Auto-join if coming from invitation link
            setTimeout(() => {
              handleJoinGame(urlRoomCode);
            }, 1000);
          }
        }, []);

        const handleJoinGame = async (code = joinRoomCode) => {
          const roomCodeToJoin = code.toUpperCase().trim();
          if (!roomCodeToJoin || roomCodeToJoin.length < 6) {
            alert('Please enter a valid 6-character Room Number');
            return;
          }
          
          const joined = await joinRoom(roomCodeToJoin, playerName || 'Player');
          if (joined) {
            setRoomCode(roomCodeToJoin);
            setScreen('waitingRoom');
          }
        };

        return (
          <div className="screen-frame">
            <div className="screen-container">
              <img src={LOGO_SMALL} alt="Link Logic" className="logo-small" onError={(e) => e.target.style.display = 'none'} />
              
              <h1 className="page-title-small">Player Modes</h1>
              
              <div className="content-box">
                <div className="mode-header">Host - Join - Find</div>
                
                <div className="input-row">
                  <div className="input-group">
                    <label className="label-cyan">Player Name:</label>
                    <input type="text" className="input-field" value={playerName || 'Mr Link-Logic'} readOnly />
                  </div>
                  <div className="input-group">
                    <label className="label-cyan">Rating</label>
                    <input type="text" className="input-field" value={`${playerRating}    r`} readOnly />
                  </div>
                </div>
                
                <button 
                  className="btn-action btn-red" 
                  onClick={() => {
                    setRoomCode(generateRoomCode());
                    setScreen('invitePlayers');
                  }}
                >
                  Host a Game
                </button>
                <div className="next-step">Next Step: Set Presets</div>
                
                <div style={{position: 'relative'}}>
                  <button 
                    className="btn-action btn-orange" 
                    onClick={handleJoinGame}
                  >
                    Join a Game
                  </button>
                  <input
                    type="text"
                    value={joinRoomCode}
                    onChange={(e) => setJoinRoomCode(e.target.value.toUpperCase())}
                    placeholder="Room #: 01T5G9P"
                    maxLength="7"
                    style={{
                      position: 'absolute',
                      right: '10px',
                      top: '50%',
                      transform: 'translateY(-50%)',
                      width: '140px',
                      padding: '8px 10px',
                      borderRadius: '6px',
                      border: '2px solid #00B0F0',
                      background: '#ECECEC',
                      fontSize: '14px',
                      fontWeight: 'bold',
                      textAlign: 'center'
                    }}
                  />
                </div>
                <div className="next-step">Next Step: Waiting Room</div>
                
                <button className="btn-action btn-cyan" style={{opacity: 0.5}} disabled>
                  Find a Game
                </button>
                <div className="next-step">Next Step: Search Online</div>
                
                <button className="btn-small" onClick={() => {
                  setReturnScreen('playerModes');
                  setScreen('instructions');
                }}>
                  Instructions
                </button>
              </div>
            </div>
          </div>
        );
      };

      // Invite Players Screen - UPDATED: Creates Firebase room
      const InvitePlayersScreen = () => {
        const [copied, setCopied] = useState(false);
        const [roomCreated, setRoomCreated] = useState(false);
        const messageRef = useRef(null);

        // Create room on mount
        useEffect(() => {
          if (roomCode && !roomCreated) {
            createRoom(roomCode, playerName || 'Host', presetConfig).then(() => {
              setRoomCreated(true);
              console.log('Firebase room created successfully');
            });
          }
        }, [roomCode]);

        const copyInvitation = () => {
          const message = messageRef.current?.value || '';
          const gameUrl = window.location.href.split('?')[0] + `?room=${roomCode}`;
          const fullMessage = `${message}\n\nRoom Number: ${roomCode}\nInstructions: https://link-logic.github.io/link-logic-game/\nClick to Join: ${gameUrl}`;
          navigator.clipboard.writeText(fullMessage).then(() => {
            setCopied(true);
            setTimeout(() => setCopied(false), 2000);
          });
          // Save the message
          setInviteMessage(message);
        };

        return (
          <div className="screen-frame">
            <div className="screen-container scrollable">
              <img src={LOGO_SMALL} alt="Link Logic" className="logo-small" onError={(e) => e.target.style.display = 'none'} />
              
              <h1 className="page-title-small">Invite Players</h1>
              
              <div className="content-box">
                <div className="section-title">Setup the Game</div>
                
                <div className="room-number-row">
                  <div className="room-label">Generate a Room Number:</div>
                  <div className="room-display">{roomCode}</div>
                </div>
                
                <div className="section-title">Send an Invitation</div>
                
                <div className="invite-container">
                  <div className="invite-box">
                    <label>Type your message here:</label>
                    <textarea 
                      ref={messageRef}
                      defaultValue={inviteMessage}
                      placeholder="Enter your invitation message..."
                    />
                    <div className="invite-text">
                      <span className="auto-text">Room Number:</span> {roomCode}<br/>
                      <span className="auto-text">Instructions:</span> [Link]<br/>
                      <span className="auto-text">Click to Join:</span> [Link]
                    </div>
                  </div>
                  
                  <div className="copy-btn-vertical">
                    <button className="copy-icon" onClick={copyInvitation}>
                      {copied ? '✓' : '📋'}
                    </button>
                    <div className="copy-label">Copy &<br/>Text</div>
                  </div>
                </div>
                
                <button className="btn-host" onClick={() => setScreen('presets')}>
                  Host a Game
                </button>
                
                <div className="coming-soon-title">Coming Soon</div>
                <div className="coming-soon-subtitle">(auto texting)</div>
                <div className="coming-soon-placeholder">
                  <div className="placeholder-row">
                    <div>Players</div>
                    <div>Response</div>
                    <div>Select</div>
                    <div>Contacts</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // Presets Screen - UPDATED: New heading format, white lettering, EDITABLE
      const PresetsScreen = () => {
        const [isEditing, setIsEditing] = useState(false);
        const [editedConfig, setEditedConfig] = useState({...presetConfig});

        // Update editedConfig when preset changes
        useEffect(() => {
          setEditedConfig({...presetConfig});
          setIsEditing(false);
        }, [selectedPreset]);

        const handleEdit = () => {
          setIsEditing(true);
        };

        const handleSave = () => {
          setPresetConfig(editedConfig);
          setIsEditing(false);
        };

        const handleReset = () => {
          const original = PRESETS[selectedPreset];
          setEditedConfig({...original});
          setPresetConfig({...original});
          setIsEditing(false);
        };

        const updateValue = (field, value) => {
          const numValue = parseInt(value) || 0;
          setEditedConfig({
            ...editedConfig,
            [field]: numValue
          });
        };

        return (
          <div className="screen-frame">
            <div className="screen-container">
              <img src={LOGO_SMALL} alt="Link Logic" className="logo-small" onError={(e) => e.target.style.display = 'none'} />
              
              <h1 className="page-title-small">Game Presets</h1>
              
              <div className="content-box">
                <div className="section-title-white">Select Difficulty Level</div>
                
                <div className="preset-grid">
                  {[1, 2, 3, 4, 5, 6, 7, 8, 9].map((num) => (
                    <button 
                      key={num}
                      className={`preset-btn preset-${num} ${selectedPreset === num ? 'selected' : ''}`}
                      onClick={() => {
                        setSelectedPreset(num);
                        const newConfig = PRESETS[num];
                        setPresetConfig(newConfig);
                        setEditedConfig({...newConfig});
                        setIsEditing(false);
                      }}
                    >
                      Preset<br/>{num}
                    </button>
                  ))}
                </div>
                
                <div className="preset-info-box">
                  <h3>Preset {selectedPreset} Settings:</h3>
                  <div className="subtitle">{editedConfig.level}</div>
                  
                  <div className="preset-details">
                    <div>
                      <strong>Words:</strong>{' '}
                      {isEditing ? (
                        <input 
                          type="number" 
                          value={editedConfig.words}
                          onChange={(e) => updateValue('words', e.target.value)}
                          style={{width: '60px', padding: '2px 5px', borderRadius: '4px', border: '2px solid #00B0F0'}}
                        />
                      ) : editedConfig.words}
                    </div>
                    <div>
                      <strong>Timer:</strong>{' '}
                      {isEditing ? (
                        <input 
                          type="number" 
                          value={editedConfig.timer}
                          onChange={(e) => updateValue('timer', e.target.value)}
                          style={{width: '60px', padding: '2px 5px', borderRadius: '4px', border: '2px solid #00B0F0'}}
                        />
                      ) : editedConfig.timer}s
                    </div>
                    <div>
                      <strong>Rounds:</strong>{' '}
                      {isEditing ? (
                        <input 
                          type="number" 
                          value={editedConfig.rounds}
                          onChange={(e) => updateValue('rounds', e.target.value)}
                          style={{width: '60px', padding: '2px 5px', borderRadius: '4px', border: '2px solid #00B0F0'}}
                        />
                      ) : editedConfig.rounds}
                    </div>
                    <div>
                      <strong>Bonus Words:</strong>{' '}
                      {isEditing ? (
                        <input 
                          type="number" 
                          value={editedConfig.bonusWords}
                          onChange={(e) => updateValue('bonusWords', e.target.value)}
                          style={{width: '60px', padding: '2px 5px', borderRadius: '4px', border: '2px solid #00B0F0'}}
                        />
                      ) : editedConfig.bonusWords}
                    </div>
                  </div>
                </div>
                
                <div className="button-row-presets">
                  <button 
                    className="btn-preset-control btn-cyan" 
                    onClick={handleEdit}
                    disabled={isEditing}
                    style={{opacity: isEditing ? 0.5 : 1, cursor: isEditing ? 'not-allowed' : 'pointer'}}
                  >
                    Edit
                  </button>
                  <button 
                    className="btn-preset-control btn-orange" 
                    onClick={handleSave}
                    disabled={!isEditing}
                    style={{opacity: !isEditing ? 0.5 : 1, cursor: !isEditing ? 'not-allowed' : 'pointer'}}
                  >
                    Save
                  </button>
                  <button 
                    className="btn-preset-control btn-red" 
                    onClick={handleReset}
                  >
                    Reset
                  </button>
                </div>
                
                <button className="btn-large" onClick={() => setScreen('hostRoom')}>
                  Let's Play
                </button>
              </div>
            </div>
          </div>
        );
      };

      // Host Room Screen - UPDATED: Firebase sync for game start
      const HostRoomScreen = () => {
        const [countdownActive, setCountdownActive] = useState(false);
        const [countdownStep, setCountdownStep] = useState(0);
        const [playersInRoom, setPlayersInRoom] = useState([]);

        useEffect(() => {
          if (!roomCode) return;

          const unsubscribe = listenToRoom(roomCode, (data) => {
            if (data.players) {
              const playerList = Object.values(data.players).map(p => p.name);
              setPlayersInRoom(playerList);
              setPlayersReady(playerList);
            }
          });

          return unsubscribe;
        }, [roomCode]);

        const startCountdown = async () => {
          setCountdownActive(true);
          setCountdownStep(1);
          setTimeout(() => setCountdownStep(2), 1500);
          setTimeout(() => setCountdownStep(3), 3000);
          
          // Generate words and update Firebase
          const words = generateWords(presetConfig.difficulty, presetConfig.words, presetConfig.bonusWords);
          
          setTimeout(async () => {
            // Update Firebase to start the game for all players
            const roomRef = database.ref(`rooms/${roomCode}`);
            await roomRef.update({
              gameState: 'playing',
              words: words,
              currentRound: 1,
              startedAt: Date.now()
            });
            
            setGameWords(words);
            setTimeLeft(presetConfig.timer);
            setScreen('gameplay');
          }, 4500);
        };

        return (
          <div className="screen-frame">
            <div className="screen-container">
              <img src={LOGO_SMALL} alt="Link Logic" className="logo-small" onError={(e) => e.target.style.display = 'none'} />
              
              <h1 className="page-title-small">Host Room</h1>
              
              {roomCode && (
                <div style={{
                  background: '#7B2CBF',
                  borderRadius: '12px',
                  padding: '10px 15px',
                  marginBottom: '15px',
                  textAlign: 'center'
                }}>
                  <div style={{color: '#00B0F0', fontSize: '14px', fontWeight: 'bold', marginBottom: '5px'}}>
                    Room Number:
                  </div>
                  <div style={{color: '#fff', fontSize: '24px', fontWeight: 'bold', letterSpacing: '2px'}}>
                    {roomCode}
                  </div>
                  <div style={{color: '#F88E00', fontSize: '12px', marginTop: '5px'}}>
                    {playersInRoom.length} player{playersInRoom.length !== 1 ? 's' : ''} ready
                  </div>
                </div>
              )}
              
              <div className="game-preview">
                <div className="word-grid">
                  {['Random Words', 'Bonus Words', 'Random Words', 'Random Words', 'Random Words', 'Random Words',
                    'Random Words', 'Random Words', 'Bonus Words', 'Random Words', 'Random Words', 'Random Words'].map((word, idx) => (
                    <div key={idx} className={`word-box ${word === 'Bonus Words' ? 'bonus' : ''}`}>
                      {word}
                    </div>
                  ))}
                </div>
                
                <div className="input-row">
                  <div className="input-group">
                    <div className="input-label">Selected Words</div>
                    <input type="text" className="input-box" value="Preview" readOnly />
                  </div>
                  <div className="input-group">
                    <div className="input-label">Link Word</div>
                    <input type="text" className="input-box" placeholder="Ready!" readOnly />
                  </div>
                </div>
              </div>
              
              <div className="controls-box">
                <div className="button-row-controls">
                  <button className="btn-host-small">Host</button>
                  <button className="btn-tap" onClick={startCountdown}>Tap to Play</button>
                </div>
                
                <div className="traffic-lights">
                  <div className={`traffic-light ${countdownStep >= 1 ? 'active-red' : ''}`}>Read</div>
                  <div className={`traffic-light ${countdownStep >= 2 ? 'active-yellow' : ''}`}>Set</div>
                  <div className={`traffic-light ${countdownStep >= 3 ? 'active-green' : ''}`}>Go</div>
                </div>
                
                <div className="players-ready-box">
                  <div className="players-ready-title">Players Ready</div>
                  
                  <div className="player-grid">
                    {playersInRoom.map((player, idx) => (
                      <div 
                        key={idx} 
                        className="player-box" 
                        style={{
                          background: idx === 0 ? 'linear-gradient(135deg, #F88E00 0%, #FF6600 100%)' : '#fff',
                          border: idx === 0 ? '3px solid #F31418' : '3px solid #4CAF50',
                          color: idx === 0 ? '#fff' : '#666',
                          fontWeight: idx === 0 ? 'bold' : 'normal',
                          boxShadow: idx === 0 ? '0 4px 8px rgba(248, 142, 0, 0.3)' : 'none'
                        }}
                      >
                        {player} {idx === 0 && '👑'}
                      </div>
                    ))}
                    {Array(Math.max(0, 6 - playersInRoom.length)).fill(null).map((_, idx) => (
                      <div key={`empty-${idx}`} className="player-box">
                        Waiting...
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // Waiting Room Screen - UPDATED: Firebase sync for real players
      const WaitingRoomScreen = () => {
        const [roomData, setRoomData] = useState(null);
        const [playersInRoom, setPlayersInRoom] = useState([]);

        useEffect(() => {
          if (!roomCode) return;

          const unsubscribe = listenToRoom(roomCode, (data) => {
            setRoomData(data);
            if (data.players) {
              const playerList = Object.values(data.players).map(p => p.name);
              setPlayersInRoom(playerList);
              setPlayersReady(playerList);
            }
            
            // If game starts, load the words and go to gameplay
            if (data.gameState === 'playing') {
              setGameWords(data.words);
              setTimeLeft(data.preset.timer);
              setCurrentRound(data.currentRound);
              setScreen('gameplay');
            }
          });

          return unsubscribe;
        }, [roomCode]);

        return (
          <div className="screen-frame">
            <div className="screen-container">
              <img src={LOGO_SMALL} alt="Link Logic" className="logo-small" onError={(e) => e.target.style.display = 'none'} />
              
              <h1 className="page-title-small">Waiting Room</h1>
              
              {roomCode && (
                <div style={{
                  background: '#7B2CBF',
                  borderRadius: '12px',
                  padding: '10px 15px',
                  marginBottom: '15px',
                  textAlign: 'center'
                }}>
                  <div style={{color: '#00B0F0', fontSize: '14px', fontWeight: 'bold', marginBottom: '5px'}}>
                    Room Number:
                  </div>
                  <div style={{color: '#fff', fontSize: '24px', fontWeight: 'bold', letterSpacing: '2px'}}>
                    {roomCode}
                  </div>
                  <div style={{color: '#F88E00', fontSize: '12px', marginTop: '5px'}}>
                    {playersInRoom.length} player{playersInRoom.length !== 1 ? 's' : ''} connected
                  </div>
                </div>
              )}
              
              <div className="game-preview">
                <div className="word-grid">
                  {['Random Words', 'Bonus Words', 'Random Words', 'Random Words', 'Random Words', 'Random Words',
                    'Random Words', 'Random Words', 'Bonus Words', 'Random Words', 'Random Words', 'Random Words'].map((word, idx) => (
                    <div key={idx} className={`word-box ${word === 'Bonus Words' ? 'bonus' : ''}`}>
                      {word}
                    </div>
                  ))}
                </div>
                
                <div className="input-row">
                  <div className="input-group">
                    <div className="input-label">Selected Words</div>
                    <input type="text" className="input-box" value="Tutorial Preview" readOnly />
                  </div>
                  <div className="input-group">
                    <div className="input-label">Link Word</div>
                    <input type="text" className="input-box" placeholder="Waiting..." readOnly />
                  </div>
                </div>
              </div>
              
              <div className="controls-box">
                <button className="btn-waiting">Waiting for Host...</button>
                
                <div className="traffic-lights">
                  <div className="traffic-light">Read</div>
                  <div className="traffic-light">Set</div>
                  <div className="traffic-light">Go</div>
                </div>
                
                <div className="players-ready-box">
                  <div className="players-ready-title">Players Ready</div>
                  
                  <div className="player-grid">
                    {playersInRoom.map((player, idx) => (
                      <div 
                        key={idx} 
                        className="player-box" 
                        style={{
                          background: idx === 0 ? 'linear-gradient(135deg, #F88E00 0%, #FF6600 100%)' : '#fff',
                          border: idx === 0 ? '3px solid #F31418' : '3px solid #4CAF50',
                          color: idx === 0 ? '#fff' : '#666',
                          fontWeight: idx === 0 ? 'bold' : 'normal',
                          boxShadow: idx === 0 ? '0 4px 8px rgba(248, 142, 0, 0.3)' : 'none'
                        }}
                      >
                        {player} {idx === 0 && '👑'}
                      </div>
                    ))}
                    {Array(Math.max(0, 6 - playersInRoom.length)).fill(null).map((_, idx) => (
                      <div key={`empty-${idx}`} className="player-box">
                        Waiting...
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // Gameplay Screen
      const GameplayScreen = () => {
        const toggleWordSelection = (wordId) => {
          if (selectedWords.includes(wordId)) {
            setSelectedWords(selectedWords.filter(id => id !== wordId));
          } else {
            setSelectedWords([...selectedWords, wordId]);
          }
        };

        const handleSubmit = () => {
          if (selectedWords.length >= 2 && linkWord.trim()) {
            const words = selectedWords.map(id => gameWords.find(w => w.id === id).text);
            const bonusCount = selectedWords.filter(id => gameWords.find(w => w.id === id).isBonus).length;
            
            let points = 0;
            if (selectedWords.length === 2) points = 2;
            else if (selectedWords.length === 3) points = 4;
            else if (selectedWords.length === 4) points = 8;
            else points = 16;
            
            points += bonusCount;
            
            setSubmissions([...submissions, {
              words: words.join(' - '),
              linkWord: linkWord,
              points: points
            }]);
            
            setSelectedWords([]);
            setLinkWord('');
          }
        };

        const formatTime = (seconds) => {
          const mins = Math.floor(seconds / 60);
          const secs = seconds % 60;
          return `${mins}:${secs.toString().padStart(2, '0')}`;
        };

        return (
          <div className="screen-frame">
            <div className="screen-container">
              <div className="top-bar">
                <img src={LOGO_SMALL} alt="Link Logic" className="logo-small" style={{position: 'static', width: '70px'}} onError={(e) => e.target.style.display = 'none'} />
                <div className="page-title">Link Logic</div>
                <div className="timer-box">
                  <div className="timer-label">Timer</div>
                  {formatTime(timeLeft)}
                </div>
              </div>
              
              <div className="content-box">
                <div className="round-title">ROUND {currentRound}</div>
                
                <div className="word-grid">
                  {gameWords.map((word) => (
                    <div 
                      key={word.id}
                      className={`word-box ${word.isBonus ? 'bonus' : ''} ${selectedWords.includes(word.id) ? 'selected' : ''}`}
                      onClick={() => toggleWordSelection(word.id)}
                    >
                      {word.text}
                    </div>
                  ))}
                </div>
                
                <div className="input-row">
                  <div className="input-group">
                    <div className="input-label">Selected Words</div>
                    <input 
                      type="text" 
                      className="input-box" 
                      value={selectedWords.map(id => gameWords.find(w => w.id === id).text).join(', ')}
                      readOnly 
                    />
                  </div>
                  <div className="input-group">
                    <div className="input-label">Link Word</div>
                    <input 
                      type="text" 
                      className="input-box" 
                      value={linkWord}
                      onChange={(e) => setLinkWord(e.target.value)}
                      placeholder="Enter"
                    />
                  </div>
                </div>
                
                <button className="btn-submit" onClick={handleSubmit}>Submit</button>
                
                <div className="keyboard">
                  {['Q','W','E','R','T','Y','U','I','O','P',
                    'A','S','D','F','G','H','J','K','L','⌫',
                    'Z','X','C','V','B','N','M','I','?','↵'].map((key, idx) => (
                    <div 
                      key={idx}
                      className={`key ${key === '↵' ? 'key-wide' : ''}`}
                      onClick={() => {
                        if (key === '⌫') setLinkWord(linkWord.slice(0, -1));
                        else if (key === '↵') handleSubmit();
                        else setLinkWord(linkWord + key);
                      }}
                    >
                      {key}
                    </div>
                  ))}
                  <div className="key key-space" onClick={() => setLinkWord(linkWord + ' ')}>space</div>
                  <div className="key key-wide">123</div>
                  <div className="key key-wide">⌨</div>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // Scoring Screen - UPDATED: No Like feature, improved Challenge popup
      const ScoringScreen = () => {
        const handleChallenge = (playerName, submission, playerIdx, subIdx) => {
          playSound('challenge');
          const submissionKey = `${playerIdx}-${subIdx}`;
          setChallengePopup({
            playerName,
            submission,
            submissionKey
          });
        };

        return (
          <div className="screen-frame">
            <div className="screen-container scrollable">
              <img src={LOGO_SMALL} alt="Link Logic" className="logo-small" onError={(e) => e.target.style.display = 'none'} />
              
              <h1 className="page-title-small">Scoring</h1>
              
              <div className="content-box">
                <div className="round-complete">ROUND {currentRound} COMPLETE</div>
                
                {[{name: playerName || 'Mr Link-Logic', submissions: submissions}, 
                  {name: 'Player2', submissions: [{words: 'BRANCH - CLAY - BLOCK', linkWord: 'BUILD', points: 5}]},
                  {name: 'Player3', submissions: [{words: 'FIRE - WATER', linkWord: 'HOSE', points: 2}]}
                ].map((player, playerIdx) => (
                  <div key={playerIdx} className="player-table">
                    <div className="player-name-header">{player.name}</div>
                    <div className="table-content">
                      <div className="table-header">
                        <div>#</div>
                        <div>Words</div>
                        <div>Link<br/>Word</div>
                        <div>Challenge</div>
                        <div>Points</div>
                      </div>
                      {player.submissions.map((sub, idx) => {
                        const submissionKey = `${playerIdx}-${idx}`;
                        const isLiked = likedSubmissions[submissionKey];
                        const isChallenged = challengedSubmissions[submissionKey];
                        
                        return (
                          <div key={idx} className="table-row">
                            <div>{idx + 1}.</div>
                            <div>{sub.words}</div>
                            <div className="link-word">{sub.linkWord}</div>
                            <div>
                              <button 
                                className="icon-btn" 
                                onClick={() => handleChallenge(player.name, sub, playerIdx, idx)}
                                style={{
                                  background: isChallenged ? '#F31418' : '#00B0F0',
                                  transform: isChallenged ? 'scale(1.1)' : 'scale(1)',
                                  transition: 'all 0.3s'
                                }}
                              >
                                {isChallenged ? '⚠' : '?'}
                              </button>
                            </div>
                            <div className="points">{sub.points}pt</div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                ))}
                
                <button 
                  className="btn-next-round" 
                  onClick={() => {
                    if (currentRound < presetConfig.rounds) {
                      setCurrentRound(currentRound + 1);
                      setGameWords(generateWords(presetConfig.difficulty, 12, 3));
                      setTimeLeft(presetConfig.timer);
                      setSubmissions([]);
                      setChallengedSubmissions({});
                      setScreen('hostRoom');
                    } else {
                      setScreen('winner');
                    }
                  }}
                >
                  {currentRound < presetConfig.rounds ? 'Next Round' : 'See Winner'}
                </button>
              </div>

              {/* Challenge Popup */}
              {challengePopup && (
                <ChallengePopup
                  playerName={challengePopup.playerName}
                  submission={challengePopup.submission}
                  submissionKey={challengePopup.submissionKey}
                  onClose={() => setChallengePopup(null)}
                />
              )}
            </div>
          </div>
        );
      };

      // Winner Screen - UPDATED: Trophy image, Final Standings centered
      const WinnerScreen = () => {
        return (
          <div className="screen-frame">
            <div className="screen-container">
              <img src={LOGO_SMALL} alt="Link Logic" className="logo-small" onError={(e) => e.target.style.display = 'none'} />
              
              <h1 className="page-title-small">Link Logic</h1>
              
              <div className="content-box">
                <div className="winner-title">Winner</div>
                
                <div className="trophy">
                  <img 
                    src={TROPHY_IMG} 
                    alt="Trophy" 
                    onError={(e) => {
                      e.target.parentElement.innerHTML = '🏆';
                    }}
                  />
                </div>
                
                <div className="winner-name-box">
                  Player Name - {playerName || 'Mr Link-Logic'}
                </div>
                
                <div className="standings-table">
                  <div className="table-header-section">Final Standings</div>
                  
                  <div className="table-header-row">
                    <div>Player</div>
                    <div>Round<br/>Points</div>
                    <div>Total<br/>points</div>
                  </div>
                  
                  {[
                    {name: playerName || 'Mr Link-Logic', round: 25, total: 30},
                    {name: 'Player2', round: 20, total: 24},
                    {name: 'Player3', round: 15, total: 18}
                  ].map((player, idx) => (
                    <div key={idx} className="table-row-standings">
                      <div>{player.name}</div>
                      <div>{player.round}</div>
                      <div>{player.total}</div>
                    </div>
                  ))}
                </div>
                
                <div className="button-row" style={{justifyContent: 'center', marginTop: '20px'}}>
                  <button className="btn-game btn-cyan" onClick={() => {
                    setCurrentRound(1);
                    setSubmissions([]);
                    setScreen('playerModes');
                  }}>
                    New Game
                  </button>
                  <button className="btn-game btn-orange" onClick={() => {
                    setCurrentRound(1);
                    setSubmissions([]);
                    setScreen('hostRoom');
                  }}>
                    Play Again
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // Render current screen
      return (
        <>
          {screen === 'welcome' && <WelcomeScreen />}
          {screen === 'register' && <RegisterScreen />}
          {screen === 'instructions' && <InstructionsScreen />}
          {screen === 'playerModes' && <PlayerModesScreen />}
          {screen === 'invitePlayers' && <InvitePlayersScreen />}
          {screen === 'presets' && <PresetsScreen />}
          {screen === 'hostRoom' && <HostRoomScreen />}
          {screen === 'waitingRoom' && <WaitingRoomScreen />}
          {screen === 'gameplay' && <GameplayScreen />}
          {screen === 'scoring' && <ScoringScreen />}
          {screen === 'winner' && <WinnerScreen />}
        </>
      );
    };

    // Render the app
    ReactDOM.render(<LinkLogicApp />, document.getElementById('root'));
  </script>
</body>
</html>
